# üöÄ SERVICES OPTIMIZATION PLAN

---

## üìã –†–µ–∑—é–º–µ –ø—Ä–æ–±–ª–µ–º

| # | –ü—Ä–æ–±–ª–µ–º–∞ | –¢–∏–ø | –í–∞–∂–Ω–æ—Å—Ç—å | –†–µ—à–µ–Ω–∏–µ |
|---|----------|-----|----------|---------|
| 1 | Jaeger + Tempo + OTEL (–∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤) | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ | –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ Tempo |
| 2 | Promtail –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–ª–æ–≥–∏ –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è) | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ | –î–æ–±–∞–≤–∏—Ç—å Promtail |
| 3 | Loki –≤ monitoring.yml (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ) | üü° –ü—Ä–æ–±–ª–µ–º–∞ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ observability |
| 4 | Alertmanager –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–Ω–µ—Ç –∞–ª–µ—Ä—Ç–æ–≤) | üü° –ü—Ä–æ–±–ª–µ–º–∞ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ | –î–æ–±–∞–≤–∏—Ç—å Alertmanager |
| 5 | cAdvisor –¥—É–±–ª–∏—Ä—É–µ—Ç Prometheus | üü° –ü—Ä–æ–±–ª–µ–º–∞ | üü¢ –ù–∏–∑–∫–æ | –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å |
| 6 | –°–µ—Ä–≤–∏—Å—ã –Ω–µ —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –º–æ–¥—É–ª–∏ | üü† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–æ | –°–æ–∑–¥–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ |

---

## ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (—ç—Ç–∞–ø 1: –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã)

#### 1. **–£–¥–∞–ª–∏—Ç—å –∏–∑ observability.yml**
- ‚ùå Jaeger (–∑–∞–º–µ–Ω—è–µ—Ç—Å—è Tempo)
- ‚ùå OTEL Collector (–Ω–µ –Ω—É–∂–µ–Ω –µ—Å–ª–∏ –µ—Å—Ç—å Tempo)

#### 2. **–î–æ–±–∞–≤–∏—Ç—å –≤ observability.yml**
- ‚úÖ Promtail (–¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤)

#### 3. **–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∏–∑ monitoring.yml –≤ observability.yml**
- ‚úÖ Loki (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

#### 4. **–î–æ–±–∞–≤–∏—Ç—å –≤ monitoring.yml**
- ‚úÖ Alertmanager (–æ–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤)

#### 5. **–û–±–Ω–æ–≤–∏—Ç—å config/prometheus/prometheus.yml**
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å alert_manager_configs
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å alert rules (config/prometheus/alert-rules.yml)

---

### –ë—ã—Å—Ç—Ä–æ (—ç—Ç–∞–ø 2: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

#### 6. **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å cAdvisor**
- –û–ø—Ü–∏—è A: –£–¥–∞–ª–∏—Ç—å (–µ—Å–ª–∏ Prometheus –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
- –û–ø—Ü–∏—è B: –û—Å—Ç–∞–≤–∏—Ç—å –Ω–æ –ø–µ—Ä–µ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å

#### 7. **–°–æ–∑–¥–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏**
- ‚úÖ mattermost.yml (–æ—Ç–¥–µ–ª—å–Ω–æ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ redmine.yml (–æ—Ç–¥–µ–ª—å–Ω–æ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ mayan-edms.yml (–æ—Ç–¥–µ–ª—å–Ω–æ, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### 8. **–û–±–Ω–æ–≤–∏—Ç—å scripts/ceres.ps1**
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å `--exclude-optional` —Ñ–ª–∞–≥
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `ceres list modules` (–ø–æ–∫–∞–∑–∞—Ç—å –∫–∞–∫–∏–µ –µ—Å—Ç—å)

---

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—ç—Ç–∞–ø 3)

#### 9. **–û–±–Ω–æ–≤–∏—Ç—å docs/**
- ‚úÖ –û–ø–∏—Å–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ vs –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ —É–¥–∞–ª–∏–ª–∏ –∏ –ø–æ—á–µ–º—É

#### 10. **–û–±–Ω–æ–≤–∏—Ç—å SERVICES_INVENTORY.md**
- ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ (Promtail, Alertmanager)

---

## üìä –î–û –ò –ü–û–°–õ–ï

### Small –ø—Ä–æ—Ñ–∏–ª—å

**–î–û:**
```
postgresql, redis,
keycloak, nextcloud, gitea, mattermost, redmine, wiki.js,
prometheus, grafana, cadvisor, exporters,
portainer, uptime-kuma,
caddy

= 17 —Å–µ—Ä–≤–∏—Å–æ–≤, 4 GB RAM
```

**–ü–û–°–õ–ï:**
```
postgresql, redis,
keycloak, nextcloud, gitea,
prometheus, grafana, exporters, alertmanager,
uptime-kuma,
caddy

= 12 —Å–µ—Ä–≤–∏—Å–æ–≤, 4 GB RAM (+3 —Å–≤–æ–±–æ–¥–Ω—ã—Ö –¥–ª—è –¥—Ä—É–≥–∏—Ö)
```

### Medium –ø—Ä–æ—Ñ–∏–ª—å

**–î–û:**
```
small +
mattermost, redmine, wiki.js,
loki, promtail (+ jaeger + otel),
wireguard, wg-easy

= 30 —Å–µ—Ä–≤–∏—Å–æ–≤, 8 GB RAM
```

**–ü–û–°–õ–ï:**
```
small +
loki, promtail, tempo, alertmanager,
wireguard, wg-easy

= 15 —Å–µ—Ä–≤–∏—Å–æ–≤, 8 GB RAM (–ø—Ä–æ—â–µ, —á–∏—â–µ)

+–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
mattermost, redmine, wiki.js, mayan
```

### Large –ø—Ä–æ—Ñ–∏–ª—å

**–î–û:**
```
medium +
patroni (3x), redis-sentinel, etcd, haproxy, keepalived,
vault,
opa,
k8s operators

= 45+ —Å–µ—Ä–≤–∏—Å–æ–≤, 56+ GB RAM
```

**–ü–û–°–õ–ï:**
```
medium +
patroni (3x), redis-sentinel, etcd, haproxy, keepalived,
vault (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
opa (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ),
k8s operators

= 25-30 —Å–µ—Ä–≤–∏—Å–æ–≤, 24 GB RAM (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)

+–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
mattermost, redmine, mayan, mail
```

---

## üéØ –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –§–∞–∑–∞ 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (30 –º–∏–Ω—É—Ç)

```
[ ] 1. –û—Ç–∫—Ä—ã—Ç—å observability.yml
[ ] 2. –£–¥–∞–ª–∏—Ç—å jaeger —Å–µ—Ä–≤–∏—Å
[ ] 3. –£–¥–∞–ª–∏—Ç—å otel-collector —Å–µ—Ä–≤–∏—Å
[ ] 4. –î–æ–±–∞–≤–∏—Ç—å promtail —Å–µ—Ä–≤–∏—Å
[ ] 5. –û—Ç–∫—Ä—ã—Ç—å monitoring.yml
[ ] 6. –í—ã—Ä–µ–∑–∞—Ç—å loki —Å–µ—Ä–≤–∏—Å
[ ] 7. –î–æ–±–∞–≤–∏—Ç—å alertmanager —Å–µ—Ä–≤–∏—Å
[ ] 8. –í—Å—Ç–∞–≤–∏—Ç—å loki –≤ observability.yml
[ ] 9. –û–±–Ω–æ–≤–∏—Ç—å prometheus.yml —Å Alertmanager config
[ ] 10. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ—Ä—Ç–æ–≤ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
```

### –§–∞–∑–∞ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (1 —á–∞—Å)

```
[ ] 11. –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å cAdvisor (—É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å?)
[ ] 12. –°–æ–∑–¥–∞—Ç—å modules/optional/ –ø–∞–ø–∫—É
[ ] 13. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å (–∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å) mattermost –≤ optional
[ ] 14. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å (–∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å) redmine –≤ optional
[ ] 15. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å (–∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å) mayan-edms –≤ optional
[ ] 16. –û–±–Ω–æ–≤–∏—Ç—å scripts/ceres.ps1 (–¥–æ–±–∞–≤–∏—Ç—å --exclude)
[ ] 17. –û–±–Ω–æ–≤–∏—Ç—å README –ø—Ä–æ—Ñ–∏–ª–∏ (–ø–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### –§–∞–∑–∞ 3: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (30 –º–∏–Ω—É—Ç)

```
[ ] 18. –û–±–Ω–æ–≤–∏—Ç—å SERVICES_INVENTORY.md
[ ] 19. –û–±–Ω–æ–≤–∏—Ç—å SERVICES_MATRIX.md
[ ] 20. –°–æ–∑–¥–∞—Ç—å SERVICES_WHAT_CHANGED.md
[ ] 21. –û–±–Ω–æ–≤–∏—Ç—å ARCHITECTURE.md
[ ] 22. –û–±–Ω–æ–≤–∏—Ç—å docs/00-QUICKSTART.md
```

---

## üíæ –ê–†–•–ò–í

**–£–¥–∞–ª—è–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- jaeger (–∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ Tempo)
- otel-collector (–Ω–µ –Ω—É–∂–µ–Ω)

**–î–æ–±–∞–≤–ª—è–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- Promtail (–∫—Ä–∏—Ç–∏—á–Ω–æ)
- Alertmanager (–≤–∞–∂–Ω–æ)

**–ü–µ—Ä–µ–º–µ—â–∞–µ–º—ã–µ:**
- Loki (–∏–∑ monitoring –≤ observability)

**–≠—Ñ—Ñ–µ–∫—Ç:**
- üü¢ –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤: 5+ ‚Üí 0
- üü¢ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è: 3+ ‚Üí 0
- üü¢ RAM —ç–∫–æ–Ω–æ–º–∏—è: ~3-5 GB –≤ Large –ø—Ä–æ—Ñ–∏–ª–µ
- üü¢ –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å: –ª—É—á—à–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

---

## üö® –†–ò–°–ö-–ê–ù–ê–õ–ò–ó

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –î–µ–π—Å—Ç–≤–∏–µ |
|------|-----------|---------|
| Portainer –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π | üü° –°—Ä–µ–¥–Ω—è—è | –û—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| Prometheus –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –º–µ—Ç—Ä–∏–∫–∏ | üî¥ –ù–∏–∑–∫–∞—è | –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º |
| cAdvisor –º–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã | üü° –°—Ä–µ–¥–Ω—è—è | –ï—Å–ª–∏ —É–¥–∞–ª—è–µ–º - —É–±–µ–¥–∏—Ç—å—Å—è –≤ Prometheus |
| Loki –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—Å—è –∏ —Å–ª–æ–º–∞–µ—Ç—Å—è | üü° –°—Ä–µ–¥–Ω—è—è | –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Promtail |

---

## üéì –í–´–í–û–î–´

| –ü—É–Ω–∫—Ç | –¢–µ–∫—É—â–µ–µ | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ |
|-------|---------|---------------|
| **–ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤** | 5+ | 0 |
| **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç–∏** | üî¥ –°–ª–æ–∂–Ω–æ | üü¢ –Ø—Å–Ω–æ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** | ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ | ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ |
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏** | üü° –ù–æ—Ä–º–∞–ª—å–Ω–æ | üü¢ –•–æ—Ä–æ—à–æ |

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

**–ù—É–∂–Ω–æ –ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º? (Y/N)**
