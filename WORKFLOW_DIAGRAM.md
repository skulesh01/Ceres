# 📊 WORKFLOW: Управление сотрудниками

## 🎯 СЦЕНАРИЙ: Новый сотрудник

```
┌─────────────────────────────────────────────────────────────────┐
│                    ВЕБ-ИНТЕРФЕЙС (РУЧНОЕ)                        │
└─────────────────────────────────────────────────────────────────┘

Шаг 1: Создание почты                 Шаг 2: Создание VPN
┌───────────────────────┐             ┌───────────────────────┐
│  https://mail.ceres   │             │  https://vpn.ceres    │
│  .local/admin         │             │  .local               │
│                       │             │                       │
│  [+] Add User         │             │  [+] New Client       │
│  Email: ivan@ceres    │             │  Name: ivan.petrov    │
│  Password: Pass123    │             │                       │
│  Name: Иван Петров    │             │  [Download .conf]     │
│                       │             │  [Show QR code]       │
│  [Create] ✅          │             │  [Create] ✅          │
└───────────────────────┘             └───────────────────────┘
         │                                      │
         │                                      │
         ▼                                      ▼
Шаг 3: Отправка конфига
┌─────────────────────────────────────────────────────────────────┐
│  https://mail.ceres.local/webmail                                │
│                                                                   │
│  To: ivan@ceres.local                                             │
│  Subject: VPN доступ                                              │
│  Attachment: ivan.petrov.conf 📎                                  │
│                                                                   │
│  "Здравствуйте! Импортируйте конфиг в WireGuard..."              │
│                                                                   │
│  [Send] ✅                                                        │
└─────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────┐
│                 АВТОМАТИЗАЦИЯ (POWERSHELL)                       │
└─────────────────────────────────────────────────────────────────┘

Одна команда:
┌─────────────────────────────────────────────────────────────────┐
│ PS> .\scripts\create-employee.ps1 `                               │
│       -Username "ivan.petrov" `                                   │
│       -FullName "Петров Иван" `                                   │
│       -Password "Pass123"                                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
            ┌─────────────────────────────────┐
            │   СКРИПТ АВТОМАТИЧЕСКИ:         │
            └─────────────────────────────────┘
                              │
            ┌─────────────────┴──────────────────┐
            │                                    │
            ▼                                    ▼
  ┌──────────────────┐                ┌──────────────────┐
  │  Mailu API       │                │  wg-easy API     │
  │  POST /users     │                │  POST /client    │
  │                  │                │                  │
  │  ✅ Создан ящик  │                │  ✅ Создан VPN   │
  └──────────────────┘                └──────────────────┘
            │                                    │
            └─────────────────┬──────────────────┘
                              ▼
                    ┌──────────────────┐
                    │  SMTP Postfix    │
                    │  Отправка письма │
                    │                  │
                    │  To: ivan@ceres  │
                    │  Attach: .conf   │
                    │  ✅ Отправлено   │
                    └──────────────────┘
                              │
                              ▼
                ┌──────────────────────────┐
                │  СОТРУДНИК ПОЛУЧАЕТ:     │
                │  ✅ Email                │
                │  ✅ Пароль               │
                │  ✅ VPN конфиг           │
                │  ✅ Инструкции           │
                └──────────────────────────┘
```

---

## 👤 ЖИЗНЕННЫЙ ЦИКЛ СОТРУДНИКА

```
┌────────────────────┐
│   ONBOARDING       │  День 1: Создание всех доступов
│   (Новый сотрудник)│
└────────────────────┘
         │
         ├─── 📧 Email: ivan@ceres.local
         ├─── 🔒 VPN: ivan.petrov.conf
         ├─── 🔑 SSO: Keycloak (опционально)
         └─── 📨 Автоматическое письмо с инструкциями
         
         ▼

┌────────────────────┐
│   ACTIVE           │  Работа: доступ ко всем ресурсам
│   (Активный)       │
└────────────────────┘
         │
         ├─── 🌐 https://wiki.ceres.local (база знаний)
         ├─── 💬 https://mattermost.ceres.local (чат)
         ├─── 📁 https://nextcloud.ceres.local (файлы)
         ├─── 🎯 https://taiga.ceres.local (задачи)
         └─── 📊 https://grafana.ceres.local (метрики)
         
         ▼

┌────────────────────┐
│   SUSPENDED        │  Временное отключение
│   (Приостановлен)  │
└────────────────────┘
         │
         ├─── ❌ VPN отключён (удалён из wg-easy)
         ├─── 📧 Email disabled (но письма сохранены)
         └─── 🔒 SSO disabled (но аккаунт существует)
         
         ▼

┌────────────────────┐
│   OFFBOARDING      │  Увольнение: полное удаление
│   (Удалён)         │
└────────────────────┘
         │
         ├─── 🗑️ VPN клиент удалён навсегда
         ├─── 📧 Почтовый ящик удалён (с архивацией)
         └─── 🔑 SSO аккаунт удалён
```

---

## 🔄 ИНТЕГРАЦИЯ СИСТЕМ

```
                    ┌────────────────────┐
                    │   АДМИНИСТРАТОР    │
                    └────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
          ┌──────────────────┐  ┌──────────────────┐
          │  ВЕБ-ИНТЕРФЕЙСЫ  │  │  POWERSHELL      │
          │                  │  │  АВТОМАТИЗАЦИЯ   │
          │  • mail.ceres    │  │                  │
          │  • vpn.ceres     │  │  create-         │
          │  • auth.ceres    │  │  employee.ps1    │
          └──────────────────┘  └──────────────────┘
                    │                   │
                    └─────────┬─────────┘
                              ▼
                    ┌────────────────────┐
                    │   BACKEND API      │
                    ├────────────────────┤
                    │ Mailu Admin API    │
                    │ wg-easy REST API   │
                    │ Keycloak Admin API │
                    └────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌────────────────┐  ┌────────────────┐  ┌────────────────┐
│  MAILU STACK   │  │  WIREGUARD     │  │  KEYCLOAK SSO  │
├────────────────┤  ├────────────────┤  ├────────────────┤
│ • Admin UI     │  │ • wg-easy UI   │  │ • User Manager │
│ • SMTP/IMAP    │  │ • VPN Server   │  │ • OAuth2/OIDC  │
│ • Webmail      │  │ • Configs      │  │ • LDAP/AD Sync │
│ • PostgreSQL   │  │ • QR Codes     │  │ • PostgreSQL   │
└────────────────┘  └────────────────┘  └────────────────┘
          │                   │                   │
          └───────────────────┼───────────────────┘
                              ▼
                    ┌────────────────────┐
                    │   КОНЕЧНЫЙ         │
                    │   ПОЛЬЗОВАТЕЛЬ     │
                    │   (СОТРУДНИК)      │
                    └────────────────────┘
```

---

## 📬 ПРИМЕР ПИСЬМА СОТРУДНИКУ

```
От: admin@ceres.local
Кому: ivan.petrov@ceres.local
Тема: 🔐 Ваши учетные данные

═══════════════════════════════════════════════════════════

Здравствуйте, Иван Петров!

Для вас созданы учетные данные для доступа к корпоративной 
инфраструктуре Ceres.

📧 ПОЧТА
   Email:    ivan.petrov@ceres.local
   Пароль:   Pass123
   Webmail:  https://mail.ceres.local/webmail
   IMAP:     mail.ceres.local:993 (SSL)
   SMTP:     mail.ceres.local:587 (STARTTLS)

🔒 VPN (WIREGUARD)
   Конфигурация во вложении: ivan.petrov.conf
   
   Инструкция по подключению:
   1. Скачайте WireGuard: https://www.wireguard.com/install/
   2. Импортируйте файл ivan.petrov.conf
   3. Активируйте подключение
   4. Проверьте доступ к внутренним ресурсам

📚 КОРПОРАТИВНЫЕ РЕСУРСЫ (через VPN)
   SSO:         https://auth.ceres.local
   Wiki:        https://wiki.ceres.local
   Чат:         https://mattermost.ceres.local
   Файлы:       https://nextcloud.ceres.local
   Git:         https://gitea.ceres.local
   Проекты:     https://taiga.ceres.local
   Документы:   https://edms.ceres.local
   Мониторинг:  https://grafana.ceres.local

При возникновении вопросов обращайтесь к администратору.

--
Ceres Enterprise Platform | Автоматическое сообщение

═══════════════════════════════════════════════════════════

Вложения: 📎 ivan.petrov.conf (342 bytes)
```

---

## 🎯 ИТОГОВАЯ СХЕМА

```
                         АДМИНИСТРАТОР
                               │
                ┌──────────────┼──────────────┐
                │                             │
           ВЕБ-АДМИНКА                   АВТОМАТИЗАЦИЯ
        (всё через браузер)             (PowerShell)
                │                             │
    ┌───────────┴───────────┐                 │
    ▼                       ▼                 ▼
┌─────────┐           ┌─────────┐      ┌─────────────┐
│  MAIL   │           │   VPN   │      │   СКРИПТ    │
│  ADMIN  │           │  ADMIN  │      │   create-   │
│         │           │         │      │   employee  │
│ mail.   │           │  vpn.   │      └─────────────┘
│ ceres   │           │  ceres  │             │
└─────────┘           └─────────┘             │
    │                       │                 │
    │                       │                 │
    └───────────┬───────────┴─────────────────┘
                │
                ▼
          BACKEND API
     (Mailu, wg-easy, Keycloak)
                │
    ┌───────────┼───────────┐
    ▼           ▼           ▼
┌────────┐ ┌────────┐ ┌────────┐
│ ПОЧТА  │ │  VPN   │ │  SSO   │
└────────┘ └────────┘ └────────┘
                │
                ▼
      📧 ПИСЬМО С КОНФИГОМ
                │
                ▼
          🧑 СОТРУДНИК
                │
                ▼
      ✅ ДОСТУП К РЕСУРСАМ
```

**Всё готово к использованию!** 🚀
