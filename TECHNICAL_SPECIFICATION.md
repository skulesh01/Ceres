# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ: CERES v3.0 ‚Üí v3.1

**–ü—Ä–æ–µ–∫—Ç**: CERES Enterprise Kubernetes Platform  
**–í–µ—Ä—Å–∏—è**: 3.0.0 ‚Üí 3.1.0  
**–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è**: 21 —è–Ω–≤–∞—Ä—è 2026  
**–ó–∞–∫–∞–∑—á–∏–∫**: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—Ä–æ–µ–∫—Ç  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Team

---

## 1. –í–í–ï–î–ï–ù–ò–ï

### 1.1. –¶–µ–ª—å –ü—Ä–æ–µ–∫—Ç–∞

–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã CERES v3.0.0 –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–µ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è production-ready —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### 1.2. –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

**–í–µ—Ä—Å–∏—è**: 3.0.0  
**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 21 —è–Ω–≤–∞—Ä—è 2026

#### –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã:
- **–†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ —Å–µ—Ä–≤–∏—Å–æ–≤**: 38
- **–†–∞–±–æ—Ç–∞—é—â–∏—Ö –ø–æ–¥–æ–≤**: 27/38 (71%)
- **–ü–∞–¥–∞—é—â–∏—Ö –ø–æ–¥–æ–≤**: 9/38 (24%)
- **–£—Ä–æ–≤–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**: ~60%
- **RAM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ**: ~12GB (–∏–∑ –Ω–∏—Ö 4-6GB –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã)

#### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ö–†–ò–¢–ò–ß–ù–û**: 4 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞ –≤ CrashLoopBackOff
2. **–ö–†–ò–¢–ò–ß–ù–û**: 5 –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
3. **–ö–†–ò–¢–ò–ß–ù–û**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–í–ê–ñ–ù–û**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ TLS/HTTPS
5. **–í–ê–ñ–ù–û**: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ VPN
6. **–í–ê–ñ–ù–û**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1.3. –¶–µ–ª–µ–≤–æ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

**–í–µ—Ä—Å–∏—è**: 3.1.0  
**–°—Ä–æ–∫**: 10 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π

#### –¶–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **–†–∞–∑–≤–µ—Ä–Ω—É—Ç–æ —Å–µ—Ä–≤–∏—Å–æ–≤**: 27 (-11 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, +2 –Ω–æ–≤—ã—Ö)
- **–†–∞–±–æ—Ç–∞—é—â–∏—Ö –ø–æ–¥–æ–≤**: 25/25 (100%)
- **–ü–∞–¥–∞—é—â–∏—Ö –ø–æ–¥–æ–≤**: 0/25 (0%)
- **–£—Ä–æ–≤–µ–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**: 95%
- **RAM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ**: ~8GB (-33%)

#### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ 100% uptime –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
- ‚úÖ HTTPS –¥–ª—è –≤—Å–µ—Ö –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ One-click VPN setup
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

---

## 2. –ë–ò–ó–ù–ï–°-–¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 2.1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### FR-1: –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–æ–ª–∂–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å 99.9% uptime –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (PostgreSQL, Redis, Keycloak, GitLab, Ingress) —Ä–∞–±–æ—Ç–∞—é—Ç 24/7
- [ ] –í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ—è (MTTR) < 5 –º–∏–Ω—É—Ç
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

#### FR-2: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –î–∞–Ω–Ω—ã—Ö
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—â–∏—â–µ–Ω—ã –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- [ ] –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞ < 30 –º–∏–Ω—É—Ç
- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ transit (HTTPS)
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ (Vault)

#### FR-3: –ï–¥–∏–Ω–∞—è –¢–æ—á–∫–∞ –í—Ö–æ–¥–∞ (SSO)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Keycloak —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
- [ ] –í—Å–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å Keycloak —á–µ—Ä–µ–∑ OAuth2/OIDC
- [ ] OAuth2 Proxy –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] GitLab, Grafana, Mattermost, Wiki.js –∏—Å–ø–æ–ª—å–∑—É—é—Ç Keycloak –Ω–∞–ø—Ä—è–º—É—é
- [ ] Portainer, Adminer, MinIO –∑–∞—â–∏—â–µ–Ω—ã —á–µ—Ä–µ–∑ OAuth2 Proxy

#### FR-4: DevOps –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è DevOps –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] GitLab —Ä–∞–±–æ—Ç–∞–µ—Ç —Å PostgreSQL –∏ Redis
- [ ] GitLab CI/CD pipeline —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω
- [ ] Container Registry –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] SonarQube –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

#### FR-5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å–æ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] Grafana –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞—à–±–æ—Ä–¥—ã
- [ ] Loki —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏ —á–µ—Ä–µ–∑ Promtail
- [ ] AlertManager –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

#### FR-6: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ CLI –±–µ–∑ —Ä—É—á–Ω—ã—Ö –∫–æ–º–∞–Ω–¥

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] CLI –∫–æ–º–∞–Ω–¥–∞ `ceres deploy` —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [ ] CLI –∫–æ–º–∞–Ω–¥–∞ `ceres fix` —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —Ç–∏–ø–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- [ ] CLI –∫–æ–º–∞–Ω–¥–∞ `ceres backup` —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
- [ ] CLI –∫–æ–º–∞–Ω–¥–∞ `ceres vpn setup` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç VPN

#### FR-7: –ü–æ—á—Ç–æ–≤–∞—è –°–∏—Å—Ç–µ–º–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Mailcow —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î–æ–º–µ–Ω @ceres.local –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SMTP –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (GitLab, Mattermost, Keycloak, AlertManager)
- [ ] –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Mailcow –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Keycloak (SSO –¥–ª—è –ø–æ—á—Ç—ã)

#### FR-8: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –°–µ—Ä–≤–∏—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π –¥–ª—è –±–µ—Å—à–æ–≤–Ω–æ–≥–æ –æ–ø—ã—Ç–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] **Keycloak SSO**: GitLab, Grafana, Mattermost, Wiki.js, Nextcloud, Mailcow
- [ ] **SMTP**: GitLab, Mattermost, Keycloak, AlertManager, Redmine –∏—Å–ø–æ–ª—å–∑—É—é—Ç Mailcow
- [ ] **Metrics**: –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus
- [ ] **Logs**: –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –ª–æ–≥–∏ –≤ Loki —á–µ—Ä–µ–∑ Promtail
- [ ] **Alerts**: AlertManager –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ Mailcow –∏ Mattermost

### 2.2. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### NFR-1: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**: < 15 –º–∏–Ω—É—Ç
- **–í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è backup**: < 5 –º–∏–Ω—É—Ç
- **–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ backup**: < 30 –º–∏–Ω—É—Ç
- **Response time –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤**: < 2 —Å–µ–∫—É–Ω–¥—ã

#### NFR-2: –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: –¥–æ 100 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–•—Ä–∞–Ω–∏–ª–∏—â–µ**: –¥–æ 500GB –¥–∞–Ω–Ω—ã—Ö
- **–°–µ—Ä–≤–∏—Å—ã**: –¥–æ 50 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

#### NFR-3: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- **Uptime**: 99.9% –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **RTO** (Recovery Time Objective): < 30 –º–∏–Ω—É—Ç
- **RPO** (Recovery Point Objective): < 24 —á–∞—Å–∞

#### NFR-4: –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **Kubernetes**: K3s v1.28+, K8s v1.28+
- **OS**: Linux (Ubuntu 22.04, Debian 12, RHEL 9)
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: amd64, arm64

#### NFR-5: –£–¥–æ–±—Å—Ç–≤–æ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **CLI**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ü–æ–ª–Ω–∞—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º + –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

## 3. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 3.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –†–µ—à–µ–Ω–∏—è

#### 3.1.1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    CERES Platform v3.1                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ           CLI Layer (Go Application)                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Interactive Menu                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Deployment Orchestration                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Health Checks & Auto-Fix                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Backup Management                                ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - VPN Management                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                           ‚îÇ                                  ‚îÇ
‚îÇ                           ‚ñº                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ        Kubernetes Cluster (K3s/K8s)                 ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Core Infrastructure                         ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - PostgreSQL (StatefulSet)                  ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Redis (Deployment)                        ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Traefik Ingress (K3s default)             ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Security & Networking                       ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Cert-Manager (TLS automation) [NEW]       ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Keycloak (SSO)                            ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Vault (Secrets)                           ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - OAuth2 Proxy [NEW]                        ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  DevOps Platform                             ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - GitLab (Git + CI/CD + Registry)           ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - SonarQube (Code Quality)                  ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Collaboration                               ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Mattermost (Team Chat)                    ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Wiki.js (Documentation)                   ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Redmine (Project Management)              ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - MinIO (Object Storage)                    ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Monitoring & Observability                  ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Prometheus (Metrics)                      ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Grafana (Dashboards)                      ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Loki (Log Aggregation)                    ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Promtail (Log Collection) [NEW]           ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Jaeger (Distributed Tracing)              ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - AlertManager (Alerting)                   ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Backup & Recovery                           ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Velero (K8s Backup) [NEW]                 ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - MinIO (Backup Storage)                    ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Automated Daily Backups [NEW]             ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  Management & Utilities                      ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Adminer (Database UI)                     ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Portainer (K8s UI)                        ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Flux CD (GitOps)                          ‚îÇ  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ           VPN Access (WireGuard)                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Server on Proxmox (10.8.0.1)                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Clients auto-configured (10.8.0.2+)              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  - Access to ClusterIP services                     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### 3.1.2. –°–µ—Ç–µ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Internet
    ‚îÇ
    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Proxmox Host       ‚îÇ
‚îÇ  192.168.1.3        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ WireGuard VPN Server (10.8.0.1:51820)
    ‚îÇ         ‚îÇ
    ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ VPN Clients (10.8.0.2+)
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ K3s Cluster
            ‚îÇ
            ‚îú‚îÄ‚îÄ‚îÄ Pod Network (10.42.0.0/16)
            ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ Service Network (10.43.0.0/16)
                    ‚îÇ
                    ‚îú‚îÄ‚îÄ‚îÄ ClusterIP Services (internal)
                    ‚îú‚îÄ‚îÄ‚îÄ NodePort Services (30000-32767)
                    ‚îî‚îÄ‚îÄ‚îÄ LoadBalancer (via Traefik)
```

### 3.2. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫

#### 3.2.1. –û—Å–Ω–æ–≤–Ω—ã–µ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|--------|------------|
| **Container Orchestration** | K3s | v1.28+ | Lightweight Kubernetes |
| **CLI Application** | Go | 1.21+ | Automation tool |
| **Infrastructure as Code** | Terraform | 1.6+ | Cloud provisioning |
| **GitOps** | Flux CD | 2.2+ | Continuous deployment |
| **Package Manager** | kubectl manifests | - | Service deployment |

#### 3.2.2. Core Services

| Service | Image | Version | Storage |
|---------|-------|---------|---------|
| PostgreSQL | postgres | 16 | 10Gi PVC |
| Redis | redis | 7.0 | 5Gi PVC |
| Keycloak | quay.io/keycloak/keycloak | 23.0 | - |
| GitLab | gitlab/gitlab-ce | latest | 20Gi PVC |

#### 3.2.3. –ù–æ–≤—ã–µ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (v3.1)

| Service | Image | Version | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|-------|---------|------------|
| **Cert-Manager** | quay.io/jetstack/cert-manager-controller | v1.13.0 | TLS automation |
| **Velero** | velero/velero | v1.12.0 | Backup/Restore |
| **Promtail** | grafana/promtail | 2.9.0 | Log collection |
| **OAuth2 Proxy** | quay.io/oauth2-proxy/oauth2-proxy | v7.5.0 | SSO gateway |
| **Mailcow** | mailcow/mailcow-dockerized | latest | Email server |
| **Postfix** | mailcow/postfix | latest | SMTP relay |

### 3.3. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ

#### 3.3.1. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**Single-node K3s**:
- **CPU**: 4 cores
- **RAM**: 8 GB
- **Storage**: 100 GB SSD
- **Network**: 100 Mbps

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ**:
- **CPU**: 8 cores
- **RAM**: 16 GB
- **Storage**: 200 GB NVMe SSD
- **Network**: 1 Gbps

#### 3.3.2. Production –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**Multi-node K3s (3 nodes)**:
- **Master Node**: 4 CPU, 8GB RAM, 100GB SSD
- **Worker Nodes (x2)**: 8 CPU, 16GB RAM, 200GB SSD
- **Total**: 20 CPU, 40GB RAM, 500GB Storage

---

## 4. –î–ï–¢–ê–õ–¨–ù–´–ï –ó–ê–î–ê–ß–ò

### 4.1. –§–ê–ó–ê 1: –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø (–î–µ–Ω—å 1-2)

#### –ó–∞–¥–∞—á–∞ 1.1: –£–¥–∞–ª–µ–Ω–∏–µ –î—É–±–ª–∏—Ä—É—é—â–∏—Ö –°–µ—Ä–≤–∏—Å–æ–≤
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 1 —á–∞—Å  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å 5 –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ —É–ø—Ä–æ—â–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
```bash
# –£–¥–∞–ª–∏—Ç—å namespaces —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
kubectl delete namespace elasticsearch
kubectl delete namespace kibana
kubectl delete namespace harbor
kubectl delete namespace jenkins
kubectl delete namespace uptime-kuma
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è**:
- **Elasticsearch + Kibana**: –î—É–±–ª–∏—Ä—É—é—Ç Loki + Grafana (—Ñ—É–Ω–∫—Ü–∏—è: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **Harbor**: –î—É–±–ª–∏—Ä—É–µ—Ç GitLab Container Registry
- **Jenkins**: –î—É–±–ª–∏—Ä—É–µ—Ç GitLab CI/CD
- **Uptime Kuma**: –î—É–±–ª–∏—Ä—É–µ—Ç Prometheus + AlertManager

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/cleanup.go
func (d *Deployer) RemoveDuplicates() error {
    duplicates := []string{
        "elasticsearch", "kibana", "harbor", 
        "jenkins", "uptime-kuma",
    }
    
    for _, ns := range duplicates {
        cmd := exec.Command("kubectl", "delete", "namespace", ns)
        if err := cmd.Run(); err != nil {
            fmt.Printf("Warning: Failed to delete %s: %v\n", ns, err)
        } else {
            fmt.Printf("‚úÖ Deleted duplicate namespace: %s\n", ns)
        }
    }
    return nil
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CLI**:
```go
// cmd/ceres/main.go
cmd.AddCommand(&cobra.Command{
    Use:   "cleanup",
    Short: "–£–¥–∞–ª–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã",
    RunE: func(cmd *cobra.Command, args []string) error {
        deployer, _ := deployment.NewDeployer("proxmox", "prod", "ceres")
        return deployer.RemoveDuplicates()
    },
})
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –í—Å–µ 5 namespaces —É–¥–∞–ª–µ–Ω—ã
- [ ] RAM usage —Å–Ω–∏–∂–µ–Ω –Ω–∞ ~4GB
- [ ] –ö–æ–º–∞–Ω–¥–∞ `ceres cleanup` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

**–†–∏—Å–∫–∏**:
- –í–æ–∑–º–æ–∂–Ω–∞ –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Elasticsearch (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

#### –ó–∞–¥–∞—á–∞ 1.2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Ingress NGINX
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 2 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ—á–∏–Ω–∏—Ç—å Ingress NGINX Controller –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```bash
kubectl logs -n ingress-nginx ingress-nginx-controller-xxx --tail=50
kubectl describe pod -n ingress-nginx ingress-nginx-controller-xxx
```

**–¢–∏–ø–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
1. **Port conflict** —Å Traefik (K3s default)
2. **RBAC permissions** –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã
3. **Resource limits** —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–µ

**–†–µ—à–µ–Ω–∏–µ**:
```yaml
# deployment/ingress-nginx-fixed.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: ingress-nginx
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ingress-nginx-controller
  namespace: ingress-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/component: controller
      app.kubernetes.io/name: ingress-nginx
  template:
    metadata:
      labels:
        app.kubernetes.io/component: controller
        app.kubernetes.io/name: ingress-nginx
    spec:
      serviceAccountName: ingress-nginx
      containers:
      - name: controller
        image: registry.k8s.io/ingress-nginx/controller:v1.9.0
        args:
        - /nginx-ingress-controller
        - --election-id=ingress-controller-leader
        - --controller-class=k8s.io/ingress-nginx
        - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller
        - --http-port=8080      # –ù–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å Traefik:80
        - --https-port=8443     # –ù–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å Traefik:443
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        ports:
        - containerPort: 8080
          name: http
        - containerPort: 8443
          name: https
        resources:
          requests:
            cpu: 100m
            memory: 90Mi
          limits:
            cpu: 500m
            memory: 256Mi
---
apiVersion: v1
kind: Service
metadata:
  name: ingress-nginx-controller
  namespace: ingress-nginx
spec:
  type: NodePort
  selector:
    app.kubernetes.io/component: controller
    app.kubernetes.io/name: ingress-nginx
  ports:
  - name: http
    port: 80
    targetPort: 8080
    nodePort: 30080
  - name: https
    port: 443
    targetPort: 8443
    nodePort: 30443
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/deployer.go
func (d *Deployer) FixIngressNginx() error {
    // 1. Delete existing broken deployment
    exec.Command("kubectl", "delete", "deployment", 
        "ingress-nginx-controller", "-n", "ingress-nginx").Run()
    
    // 2. Apply fixed manifest
    d.applyManifest("deployment/ingress-nginx-fixed.yaml")
    
    // 3. Wait for readiness
    return d.waitForPods("ingress-nginx", 
        "app.kubernetes.io/component=controller", 120)
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Pod –≤ —Å—Ç–∞—Ç—É—Å–µ Running
- [ ] NodePort 30080/30443 –¥–æ—Å—Ç—É–ø–Ω—ã
- [ ] HTTP –∑–∞–ø—Ä–æ—Å –Ω–∞ http://192.168.1.3:30080 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 (nginx —Ä–∞–±–æ—Ç–∞–µ—Ç)
- [ ] Ingress routes –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

---

#### –ó–∞–¥–∞—á–∞ 1.3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Keycloak
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 3 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ—á–∏–Ω–∏—Ç—å Keycloak –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è SSO —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```bash
kubectl logs -n ceres keycloak-xxx --tail=100
```

**–¢–∏–ø–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
1. **Database connection failed**: –ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
2. **Schema not initialized**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–Ω–∞
3. **Insufficient memory**: OOMKilled

**–†–µ—à–µ–Ω–∏–µ**:
```yaml
# deployment/keycloak-fixed.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: keycloak
  namespace: ceres
spec:
  replicas: 1
  selector:
    matchLabels:
      app: keycloak
  template:
    metadata:
      labels:
        app: keycloak
    spec:
      initContainers:
      # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ PostgreSQL
      - name: wait-for-postgres
        image: postgres:16
        command:
        - sh
        - -c
        - |
          until pg_isready -h postgresql.ceres-core.svc.cluster.local -p 5432 -U postgres; do
            echo "Waiting for PostgreSQL..."
            sleep 2
          done
      containers:
      - name: keycloak
        image: quay.io/keycloak/keycloak:23.0
        args:
        - start
        - --auto-build
        - --db=postgres
        - --features=token-exchange
        - --http-enabled=true
        - --http-port=8080
        - --hostname-strict=false
        - --proxy=edge
        env:
        - name: KEYCLOAK_ADMIN
          value: admin
        - name: KEYCLOAK_ADMIN_PASSWORD
          value: K3yClo@k!2025
        - name: KC_DB
          value: postgres
        - name: KC_DB_URL
          value: jdbc:postgresql://postgresql.ceres-core.svc.cluster.local:5432/keycloak
        - name: KC_DB_USERNAME
          value: postgres
        - name: KC_DB_PASSWORD
          value: ceres_postgres_2025
        - name: KC_HEALTH_ENABLED
          value: "true"
        - name: JAVA_OPTS
          value: "-Xms512m -Xmx1024m"
        ports:
        - containerPort: 8080
          name: http
        resources:
          requests:
            cpu: 500m
            memory: 1Gi
          limits:
            cpu: 1000m
            memory: 2Gi
        livenessProbe:
          httpGet:
            path: /health/live
            port: 8080
          initialDelaySeconds: 120
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 8080
          initialDelaySeconds: 60
          periodSeconds: 5
```

**–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î**:
```bash
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –±–∞–∑–∞ keycloak —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
kubectl exec -n ceres-core postgresql-0 -- psql -U postgres -c "\l" | grep keycloak
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/deployer.go
func (d *Deployer) FixKeycloak() error {
    // 1. Ensure database exists
    d.ensureDatabase("keycloak")
    
    // 2. Delete failed pod
    exec.Command("kubectl", "delete", "pod", "-n", "ceres", 
        "-l", "app=keycloak").Run()
    
    // 3. Apply fixed manifest
    d.applyManifest("deployment/keycloak-fixed.yaml")
    
    // 4. Wait for readiness (longer timeout)
    return d.waitForPods("ceres", "app=keycloak", 300)
}

func (d *Deployer) ensureDatabase(dbName string) error {
    cmd := exec.Command("kubectl", "exec", "-n", "ceres-core", 
        "postgresql-0", "--", "psql", "-U", "postgres", 
        "-c", fmt.Sprintf("CREATE DATABASE %s;", dbName))
    cmd.Run() // Ignore error if exists
    return nil
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Pod –≤ —Å—Ç–∞—Ç—É—Å–µ Running
- [ ] Health endpoints (/health/live, /health/ready) –æ—Ç–≤–µ—á–∞—é—Ç 200
- [ ] Admin console –¥–æ—Å—Ç—É–ø–µ–Ω (http://keycloak-ip:8080)
- [ ] –í—Ö–æ–¥ —Å admin / K3yClo@k!2025 —Ä–∞–±–æ—Ç–∞–µ—Ç

---

#### –ó–∞–¥–∞—á–∞ 1.4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GitLab
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 4 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ—á–∏–Ω–∏—Ç—å GitLab –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è DevOps –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```bash
kubectl logs -n gitlab gitlab-xxx --tail=200
```

**–¢–∏–ø–æ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:
1. **Redis connection timeout**: –ù–µ–≤–µ—Ä–Ω—ã–π host/password
2. **PostgreSQL initialization failed**: –ë–∞–∑–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ –∏–ª–∏ —Å—Ö–µ–º–∞ —É—Å—Ç–∞—Ä–µ–ª–∞
3. **OOMKilled**: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ (GitLab —Ç—Ä–µ–±—É–µ—Ç 4GB+)

**–†–µ—à–µ–Ω–∏–µ**:
```yaml
# deployment/gitlab-fixed.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gitlab
  namespace: gitlab
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gitlab
  template:
    metadata:
      labels:
        app: gitlab
    spec:
      initContainers:
      # Wait for PostgreSQL
      - name: wait-postgres
        image: postgres:16
        command: ['sh', '-c', 
          'until pg_isready -h postgresql.ceres-core.svc.cluster.local -U postgres; do sleep 2; done']
      # Wait for Redis
      - name: wait-redis
        image: redis:7.0
        command: ['sh', '-c',
          'until redis-cli -h redis.ceres-core.svc.cluster.local -a ceres_redis_2025 ping; do sleep 2; done']
      containers:
      - name: gitlab
        image: gitlab/gitlab-ce:16.7.0-ce.0
        ports:
        - containerPort: 80
          name: http
        - containerPort: 22
          name: ssh
        env:
        - name: GITLAB_OMNIBUS_CONFIG
          value: |
            external_url 'http://gitlab.ceres.local'
            gitlab_rails['initial_root_password'] = 'GitLab@Root2025'
            
            # PostgreSQL
            postgresql['enable'] = false
            gitlab_rails['db_adapter'] = 'postgresql'
            gitlab_rails['db_encoding'] = 'utf8'
            gitlab_rails['db_host'] = 'postgresql.ceres-core.svc.cluster.local'
            gitlab_rails['db_port'] = 5432
            gitlab_rails['db_database'] = 'gitlab'
            gitlab_rails['db_username'] = 'postgres'
            gitlab_rails['db_password'] = 'ceres_postgres_2025'
            
            # Redis
            redis['enable'] = false
            gitlab_rails['redis_host'] = 'redis.ceres-core.svc.cluster.local'
            gitlab_rails['redis_port'] = 6379
            gitlab_rails['redis_password'] = 'ceres_redis_2025'
            
            # Performance tuning
            puma['worker_processes'] = 2
            sidekiq['max_concurrency'] = 10
            prometheus_monitoring['enable'] = false
            
            # Disable unused features
            gitlab_rails['gitlab_email_enabled'] = false
            gitlab_rails['gitlab_default_can_create_group'] = true
            
        resources:
          requests:
            cpu: 1000m
            memory: 4Gi
          limits:
            cpu: 2000m
            memory: 8Gi
        volumeMounts:
        - name: gitlab-data
          mountPath: /var/opt/gitlab
        - name: gitlab-config
          mountPath: /etc/gitlab
        - name: gitlab-logs
          mountPath: /var/log/gitlab
        livenessProbe:
          httpGet:
            path: /-/liveness
            port: 80
          initialDelaySeconds: 300
          periodSeconds: 30
          timeoutSeconds: 10
        readinessProbe:
          httpGet:
            path: /-/readiness
            port: 80
          initialDelaySeconds: 180
          periodSeconds: 10
      volumes:
      - name: gitlab-data
        persistentVolumeClaim:
          claimName: gitlab-data
      - name: gitlab-config
        emptyDir: {}
      - name: gitlab-logs
        emptyDir: {}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: gitlab-data
  namespace: gitlab
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
func (d *Deployer) FixGitLab() error {
    // 1. Ensure database exists
    d.ensureDatabase("gitlab")
    
    // 2. Delete failed pod (force)
    exec.Command("kubectl", "delete", "pod", "-n", "gitlab",
        "-l", "app=gitlab", "--force", "--grace-period=0").Run()
    
    // 3. Apply fixed manifest with PVC
    d.applyManifest("deployment/gitlab-fixed.yaml")
    
    // 4. Wait for readiness (very long timeout for GitLab)
    fmt.Println("‚è≥ GitLab startup takes 5-10 minutes...")
    return d.waitForPods("gitlab", "app=gitlab", 600)
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Pod –≤ —Å—Ç–∞—Ç—É—Å–µ Running
- [ ] HTTP endpoint –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –í—Ö–æ–¥ —Å root / GitLab@Root2025 —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
- [ ] Container Registry —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–∏—Å–∫–∏**:
- GitLab —Ç—Ä–µ–±—É–µ—Ç 4-8GB RAM (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –º–∞–ª—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö)

---

#### –ó–∞–¥–∞—á–∞ 1.5: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Nextcloud (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 2 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ—á–∏–Ω–∏—Ç—å Nextcloud –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫–∞.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MinIO (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç) + WebUI

**–†–µ—à–µ–Ω–∏–µ**: –°–º. –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫–∞–∫ —Å Keycloak (initContainer + –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ env vars)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Pod –≤ —Å—Ç–∞—Ç—É—Å–µ Running
- [ ] Web UI –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å/—Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã

---

### 4.2. –§–ê–ó–ê 2: TLS/HTTPS –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø (–î–µ–Ω—å 3)

#### –ó–∞–¥–∞—á–∞ 2.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Cert-Manager
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 2 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Cert-Manager –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
```yaml
# deployment/cert-manager.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: cert-manager
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: cert-manager
  namespace: kube-system
spec:
  repo: https://charts.jetstack.io
  chart: cert-manager
  version: v1.13.3
  targetNamespace: cert-manager
  set:
    installCRDs: "true"
    global.leaderElection.namespace: "cert-manager"
```

**–°–æ–∑–¥–∞–Ω–∏–µ ClusterIssuer**:
```yaml
# deployment/cluster-issuer.yaml
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: selfsigned-issuer
spec:
  selfSigned: {}
---
# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: Let's Encrypt –¥–ª—è production
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@ceres.local
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
    - http01:
        ingress:
          class: nginx
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/tls.go
package deployment

func (d *Deployer) SetupTLS() error {
    fmt.Println("üì¶ Installing Cert-Manager...")
    
    // 1. Apply cert-manager Helm chart
    if err := d.applyManifest("deployment/cert-manager.yaml"); err != nil {
        return err
    }
    
    // 2. Wait for cert-manager pods
    d.waitForPods("cert-manager", "app.kubernetes.io/name=cert-manager", 120)
    
    // 3. Create ClusterIssuers
    fmt.Println("üì¶ Creating ClusterIssuers...")
    if err := d.applyManifest("deployment/cluster-issuer.yaml"); err != nil {
        return err
    }
    
    // 4. Update ingress routes with TLS
    fmt.Println("üì¶ Enabling TLS for Ingress routes...")
    if err := d.applyManifest("deployment/ingress-routes-tls.yaml"); err != nil {
        return err
    }
    
    fmt.Println("‚úÖ TLS automation enabled")
    return nil
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Cert-manager pods Running
- [ ] ClusterIssuer —Å–æ–∑–¥–∞–Ω (kubectl get clusterissuer)
- [ ] Test certificate –≤—ã–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ

---

#### –ó–∞–¥–∞—á–∞ 2.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Ingress Routes —Å TLS
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 1 —á–∞—Å  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ Ingress –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è HTTPS.

**–ü—Ä–∏–º–µ—Ä**:
```yaml
# deployment/ingress-routes-tls.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: grafana-ingress
  namespace: monitoring
  annotations:
    cert-manager.io/cluster-issuer: selfsigned-issuer
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - grafana.ceres.local
    secretName: grafana-tls
  rules:
  - host: grafana.ceres.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: grafana
            port:
              number: 3000
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: gitlab-ingress
  namespace: gitlab
  annotations:
    cert-manager.io/cluster-issuer: selfsigned-issuer
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
spec:
  ingressClassName: nginx
  tls:
  - hosts:
    - gitlab.ceres.local
    secretName: gitlab-tls
  rules:
  - host: gitlab.ceres.local
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: gitlab
            port:
              number: 80
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –í—Å–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ HTTPS
- [ ] –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø—É—Å–∫–∞—é—Ç—Å—è
- [ ] HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—Å—è –Ω–∞ HTTPS

---

### 4.3. –§–ê–ó–ê 3: BACKUP & RECOVERY (–î–µ–Ω—å 4)

#### –ó–∞–¥–∞—á–∞ 3.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Velero
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 3 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Velero –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
```yaml
# deployment/velero.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: velero
---
# MinIO bucket –¥–ª—è –±—ç–∫–∞–ø–æ–≤
apiVersion: batch/v1
kind: Job
metadata:
  name: create-backup-bucket
  namespace: minio
spec:
  template:
    spec:
      containers:
      - name: mc
        image: minio/mc:latest
        command:
        - sh
        - -c
        - |
          mc alias set myminio http://minio.minio.svc:9000 minioadmin MinIO@Admin2025
          mc mb myminio/ceres-backups || true
          mc policy set download myminio/ceres-backups
      restartPolicy: OnFailure
---
apiVersion: v1
kind: Secret
metadata:
  name: velero-credentials
  namespace: velero
stringData:
  cloud: |
    [default]
    aws_access_key_id = minioadmin
    aws_secret_access_key = MinIO@Admin2025
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: velero
  namespace: kube-system
spec:
  repo: https://vmware-tanzu.github.io/helm-charts
  chart: velero
  version: 5.1.0
  targetNamespace: velero
  valuesContent: |-
    configuration:
      provider: aws
      backupStorageLocation:
        bucket: ceres-backups
        config:
          region: minio
          s3ForcePathStyle: true
          s3Url: http://minio.minio.svc:9000
      volumeSnapshotLocation:
        config:
          region: minio
    credentials:
      existingSecret: velero-credentials
    initContainers:
    - name: velero-plugin-for-aws
      image: velero/velero-plugin-for-aws:v1.8.0
      volumeMounts:
      - mountPath: /target
        name: plugins
    schedules:
      daily:
        disabled: false
        schedule: "0 2 * * *"
        template:
          ttl: "720h"
          includedNamespaces:
          - ceres
          - ceres-core
          - monitoring
          - gitlab
          - mattermost
          - wiki
          - redmine
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/backup/backup.go
package backup

import (
    "fmt"
    "os/exec"
    "time"
)

type BackupManager struct {
    deployer *deployment.Deployer
}

func NewBackupManager(deployer *deployment.Deployer) *BackupManager {
    return &BackupManager{deployer: deployer}
}

func (b *BackupManager) Setup() error {
    fmt.Println("üì¶ Installing Velero...")
    
    // 1. Create MinIO bucket
    b.deployer.ApplyManifest("deployment/velero.yaml")
    
    // 2. Wait for job completion
    time.Sleep(30 * time.Second)
    
    // 3. Wait for Velero pod
    b.deployer.WaitForPods("velero", "app.kubernetes.io/name=velero", 120)
    
    fmt.Println("‚úÖ Velero installed with daily backups")
    return nil
}

func (b *BackupManager) CreateBackup(name string) error {
    if name == "" {
        name = fmt.Sprintf("manual-%s", time.Now().Format("20060102-150405"))
    }
    
    fmt.Printf("üì¶ Creating backup: %s\n", name)
    
    cmd := exec.Command("kubectl", "exec", "-n", "velero",
        "deploy/velero", "--", "velero", "backup", "create", name,
        "--include-namespaces", "ceres,ceres-core,monitoring,gitlab",
        "--wait")
    
    output, err := cmd.CombinedOutput()
    if err != nil {
        return fmt.Errorf("backup failed: %v\n%s", err, output)
    }
    
    fmt.Println("‚úÖ Backup created successfully")
    return nil
}

func (b *BackupManager) ListBackups() (string, error) {
    cmd := exec.Command("kubectl", "exec", "-n", "velero",
        "deploy/velero", "--", "velero", "backup", "get")
    output, err := cmd.Output()
    return string(output), err
}

func (b *BackupManager) Restore(backupName string) error {
    fmt.Printf("üîÑ Restoring from backup: %s\n", backupName)
    
    cmd := exec.Command("kubectl", "exec", "-n", "velero",
        "deploy/velero", "--", "velero", "restore", "create",
        "--from-backup", backupName, "--wait")
    
    output, err := cmd.CombinedOutput()
    if err != nil {
        return fmt.Errorf("restore failed: %v\n%s", err, output)
    }
    
    fmt.Println("‚úÖ Restore completed")
    return nil
}

func (b *BackupManager) ScheduleStatus() (string, error) {
    cmd := exec.Command("kubectl", "exec", "-n", "velero",
        "deploy/velero", "--", "velero", "schedule", "get")
    output, err := cmd.Output()
    return string(output), err
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ CLI**:
```go
// cmd/ceres/main.go
func backupInteractive() error {
    fmt.Println("\nüíæ –†–ï–ó–ï–†–í–ù–û–ï –ö–û–ü–ò–†–û–í–ê–ù–ò–ï")
    fmt.Println("  1. –°–æ–∑–¥–∞—Ç—å backup —Å–µ–π—á–∞—Å")
    fmt.Println("  2. –°–ø–∏—Å–æ–∫ backups")
    fmt.Println("  3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup")
    fmt.Println("  4. –°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–±—ç–∫–∞–ø–æ–≤")
    fmt.Println("  0. –ù–∞–∑–∞–¥")
    
    var choice int
    fmt.Scanln(&choice)
    
    deployer, _ := deployment.NewDeployer("proxmox", "prod", "ceres")
    backupMgr := backup.NewBackupManager(deployer)
    
    switch choice {
    case 1:
        return backupMgr.CreateBackup("")
    case 2:
        list, err := backupMgr.ListBackups()
        fmt.Println(list)
        return err
    case 3:
        fmt.Print("–ò–º—è backup: ")
        var name string
        fmt.Scanln(&name)
        return backupMgr.Restore(name)
    case 4:
        status, err := backupMgr.ScheduleStatus()
        fmt.Println(status)
        return err
    }
    return nil
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Velero pod Running
- [ ] MinIO bucket —Å–æ–∑–¥–∞–Ω
- [ ] –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π backup schedule —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –†—É—á–Ω–æ–π backup —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞ < 5 –º–∏–Ω—É—Ç
- [ ] Restore —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 4.4. –§–ê–ó–ê 4: LOGGING PIPELINE (–î–µ–Ω—å 5)

#### –ó–∞–¥–∞—á–∞ 4.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Promtail
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 2 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Promtail –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –ø–æ–¥–æ–≤.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
```yaml
# deployment/promtail.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: promtail
  namespace: monitoring
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: promtail
rules:
- apiGroups: [""]
  resources:
  - nodes
  - nodes/proxy
  - services
  - endpoints
  - pods
  verbs: ["get", "watch", "list"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: promtail
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: promtail
subjects:
- kind: ServiceAccount
  name: promtail
  namespace: monitoring
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: promtail-config
  namespace: monitoring
data:
  promtail.yaml: |
    server:
      http_listen_port: 9080
      grpc_listen_port: 0
    
    positions:
      filename: /tmp/positions.yaml
    
    clients:
      - url: http://loki.monitoring.svc:3100/loki/api/v1/push
    
    scrape_configs:
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_node_name]
            target_label: node_name
          - source_labels: [__meta_kubernetes_namespace]
            target_label: namespace
          - source_labels: [__meta_kubernetes_pod_name]
            target_label: pod
          - source_labels: [__meta_kubernetes_pod_container_name]
            target_label: container
          - source_labels: [__meta_kubernetes_pod_label_app]
            target_label: app
          - replacement: /var/log/pods/*$1/*.log
            separator: /
            source_labels:
            - __meta_kubernetes_pod_uid
            - __meta_kubernetes_pod_container_name
            target_label: __path__
---
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: promtail
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app: promtail
  template:
    metadata:
      labels:
        app: promtail
    spec:
      serviceAccountName: promtail
      containers:
      - name: promtail
        image: grafana/promtail:2.9.3
        args:
        - -config.file=/etc/promtail/promtail.yaml
        env:
        - name: HOSTNAME
          valueFrom:
            fieldRef:
              fieldPath: spec.nodeName
        volumeMounts:
        - name: config
          mountPath: /etc/promtail
        - name: run
          mountPath: /run/promtail
        - name: pods
          mountPath: /var/log/pods
          readOnly: true
        ports:
        - containerPort: 9080
          name: http-metrics
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 200m
            memory: 256Mi
      volumes:
      - name: config
        configMap:
          name: promtail-config
      - name: run
        hostPath:
          path: /run/promtail
      - name: pods
        hostPath:
          path: /var/log/pods
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/logging.go
func (d *Deployer) SetupLogging() error {
    fmt.Println("üì¶ Installing Promtail...")
    
    // 1. Apply Promtail DaemonSet
    if err := d.applyManifest("deployment/promtail.yaml"); err != nil {
        return err
    }
    
    // 2. Wait for DaemonSet
    d.waitForPods("monitoring", "app=promtail", 60)
    
    fmt.Println("‚úÖ Log collection enabled")
    fmt.Println("üìä View logs in Grafana ‚Üí Explore ‚Üí Loki")
    return nil
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Promtail DaemonSet pods Running –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö
- [ ] –õ–æ–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ Loki
- [ ] –í Grafana –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ Explore

---

### 4.5. –§–ê–ó–ê 5: VPN AUTOMATION (–î–µ–Ω—å 6)

#### –ó–∞–¥–∞—á–∞ 5.1: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è WireGuard Setup
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 3 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π setup VPN.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**: –°–º. QUICK_ANALYSIS.md, —Ä–∞–∑–¥–µ–ª Priority 4

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –ö–æ–º–∞–Ω–¥–∞ `ceres vpn setup` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á–∏
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª ceres-vpn-client.conf
- [ ] –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –≤—ã–≤–æ–¥—è—Ç—Å—è

---

### 4.6. –§–ê–ó–ê 6: MAILCOW & SMTP (–î–µ–Ω—å 7)

#### –ó–∞–¥–∞—á–∞ 6.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Mailcow
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 4 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**:
```yaml
# deployment/mailcow.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: mailcow
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mailcow-data
  namespace: mailcow
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mailcow
  namespace: mailcow
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mailcow
  template:
    metadata:
      labels:
        app: mailcow
    spec:
      containers:
      # Postfix (SMTP)
      - name: postfix
        image: mailcow/postfix:1.70
        ports:
        - containerPort: 25
          name: smtp
        - containerPort: 587
          name: submission
        env:
        - name: MAILCOW_HOSTNAME
          value: mail.ceres.local
        - name: MAILCOW_DOMAIN
          value: ceres.local
        volumeMounts:
        - name: mailcow-data
          mountPath: /var/vmail
          subPath: vmail
      # Dovecot (IMAP)
      - name: dovecot
        image: mailcow/dovecot:1.70
        ports:
        - containerPort: 143
          name: imap
        - containerPort: 993
          name: imaps
        volumeMounts:
        - name: mailcow-data
          mountPath: /var/vmail
          subPath: vmail
      # SOGo (Webmail)
      - name: sogo
        image: mailcow/sogo:1.70
        ports:
        - containerPort: 20000
          name: http
        env:
        - name: SOGO_OIDC_ENABLED
          value: "true"
        - name: SOGO_OIDC_ISSUER
          value: http://keycloak.ceres.svc.cluster.local:8080/realms/ceres
        - name: SOGO_OIDC_CLIENT_ID
          value: mailcow
        - name: SOGO_OIDC_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              name: mailcow-oidc
              key: client-secret
      volumes:
      - name: mailcow-data
        persistentVolumeClaim:
          claimName: mailcow-data
---
apiVersion: v1
kind: Service
metadata:
  name: mailcow-smtp
  namespace: mailcow
spec:
  selector:
    app: mailcow
  ports:
  - name: smtp
    port: 25
    targetPort: 25
  - name: submission
    port: 587
    targetPort: 587
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: mailcow-webmail
  namespace: mailcow
spec:
  selector:
    app: mailcow
  ports:
  - port: 80
    targetPort: 20000
  type: ClusterIP
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/mail.go
package deployment

import (
    "fmt"
    "os/exec"
)

type MailManager struct {
    deployer *Deployer
}

func NewMailManager(deployer *Deployer) *MailManager {
    return &MailManager{deployer: deployer}
}

func (m *MailManager) Setup() error {
    fmt.Println("üìß Installing Mailcow...")
    
    // 1. Deploy Mailcow
    if err := m.deployer.ApplyManifest("deployment/mailcow.yaml"); err != nil {
        return err
    }
    
    // 2. Wait for readiness
    m.deployer.WaitForPods("mailcow", "app=mailcow", 180)
    
    // 3. Create Keycloak client for Mailcow
    if err := m.createKeycloakClient(); err != nil {
        return err
    }
    
    // 4. Configure SMTP for services
    if err := m.configureSMTPIntegration(); err != nil {
        return err
    }
    
    fmt.Println("‚úÖ Mailcow installed")
    fmt.Println("üìß SMTP: mailcow-smtp.mailcow.svc:587")
    fmt.Println("üåê Webmail: http://mail.ceres.local")
    return nil
}

func (m *MailManager) createKeycloakClient() error {
    // TODO: Use Keycloak API to create OIDC client
    fmt.Println("  üìù Creating Keycloak client for Mailcow...")
    return nil
}

func (m *MailManager) configureSMTPIntegration() error {
    services := []struct{
        name      string
        namespace string
        configMap string
    }{
        {"gitlab", "gitlab", "gitlab-smtp"},
        {"mattermost", "mattermost", "mattermost-smtp"},
        {"keycloak", "ceres", "keycloak-smtp"},
    }
    
    for _, svc := range services {
        fmt.Printf("  üìß Configuring SMTP for %s...\n", svc.name)
        // Apply SMTP ConfigMap
        m.deployer.ApplyManifest(fmt.Sprintf(
            "deployment/smtp-configs/%s.yaml", svc.name))
    }
    
    return nil
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] Mailcow pods Running
- [ ] SMTP –ø–æ—Ä—Ç 587 –¥–æ—Å—Ç—É–ø–µ–Ω –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞
- [ ] Webmail –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Ingress
- [ ] –¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

---

#### –ó–∞–¥–∞—á–∞ 6.2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Keycloak —Å –°–µ—Ä–≤–∏—Å–∞–º–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ö—Ä–∏—Ç–∏—á–Ω—ã–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 6 —á–∞—Å–æ–≤  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSO —á–µ—Ä–µ–∑ Keycloak –¥–ª—è –≤—Å–µ—Ö –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤.

**–°–µ—Ä–≤–∏—Å—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
1. **GitLab** - OIDC (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
2. **Grafana** - OAuth2 (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
3. **Mattermost** - SAML/OIDC (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
4. **Wiki.js** - OIDC (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)
5. **Nextcloud** - OIDC (—á–µ—Ä–µ–∑ app)
6. **Mailcow** - OIDC (SOGo)
7. **Portainer** - OAuth2 Proxy (–æ–±–µ—Ä—Ç–∫–∞)
8. **Adminer** - OAuth2 Proxy (–æ–±–µ—Ä—Ç–∫–∞)
9. **MinIO** - OAuth2 Proxy (–æ–±–µ—Ä—Ç–∫–∞)
10. **Prometheus** - OAuth2 Proxy (–æ–±–µ—Ä—Ç–∫–∞)

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

**1. GitLab OIDC**:
```yaml
# deployment/gitlab-keycloak.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: gitlab-oidc
  namespace: gitlab
data:
  gitlab.rb: |
    gitlab_rails['omniauth_enabled'] = true
    gitlab_rails['omniauth_allow_single_sign_on'] = ['openid_connect']
    gitlab_rails['omniauth_block_auto_created_users'] = false
    gitlab_rails['omniauth_auto_link_user'] = ['openid_connect']
    
    gitlab_rails['omniauth_providers'] = [
      {
        name: 'openid_connect',
        label: 'Keycloak',
        args: {
          name: 'openid_connect',
          scope: ['openid', 'profile', 'email'],
          response_type: 'code',
          issuer: 'http://keycloak.ceres.svc.cluster.local:8080/realms/ceres',
          client_auth_method: 'query',
          discovery: true,
          uid_field: 'preferred_username',
          client_options: {
            identifier: 'gitlab',
            secret: ENV['GITLAB_OIDC_SECRET'],
            redirect_uri: 'http://gitlab.ceres.local/users/auth/openid_connect/callback'
          }
        }
      }
    ]
```

**2. Grafana OAuth2**:
```yaml
# deployment/grafana-keycloak.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-oauth
  namespace: monitoring
data:
  grafana.ini: |
    [auth.generic_oauth]
    enabled = true
    name = Keycloak
    allow_sign_up = true
    client_id = grafana
    client_secret = ${GRAFANA_OIDC_SECRET}
    scopes = openid email profile
    auth_url = http://keycloak.ceres.svc.cluster.local:8080/realms/ceres/protocol/openid-connect/auth
    token_url = http://keycloak.ceres.svc.cluster.local:8080/realms/ceres/protocol/openid-connect/token
    api_url = http://keycloak.ceres.svc.cluster.local:8080/realms/ceres/protocol/openid-connect/userinfo
    role_attribute_path = contains(roles[*], 'admin') && 'Admin' || 'Viewer'
```

**3. OAuth2 Proxy (–¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –±–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ SSO)**:
```yaml
# deployment/oauth2-proxy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: oauth2-proxy
  namespace: ceres
spec:
  replicas: 1
  selector:
    matchLabels:
      app: oauth2-proxy
  template:
    metadata:
      labels:
        app: oauth2-proxy
    spec:
      containers:
      - name: oauth2-proxy
        image: quay.io/oauth2-proxy/oauth2-proxy:v7.5.1
        args:
        - --provider=oidc
        - --provider-display-name=Keycloak
        - --client-id=oauth2-proxy
        - --client-secret=$(OAUTH2_CLIENT_SECRET)
        - --oidc-issuer-url=http://keycloak.ceres.svc.cluster.local:8080/realms/ceres
        - --redirect-url=https://oauth.ceres.local/oauth2/callback
        - --cookie-secret=$(COOKIE_SECRET)
        - --email-domain=*
        - --upstream=static://202
        - --http-address=0.0.0.0:4180
        - --reverse-proxy=true
        env:
        - name: OAUTH2_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              name: oauth2-proxy-secret
              key: client-secret
        - name: COOKIE_SECRET
          valueFrom:
            secretKeyRef:
              name: oauth2-proxy-secret
              key: cookie-secret
        ports:
        - containerPort: 4180
          name: http
---
apiVersion: v1
kind: Service
metadata:
  name: oauth2-proxy
  namespace: ceres
spec:
  selector:
    app: oauth2-proxy
  ports:
  - port: 4180
    targetPort: 4180
```

**–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**:
```go
// pkg/deployment/sso.go
package deployment

import "fmt"

type SSOManager struct {
    deployer *Deployer
}

func NewSSOManager(deployer *Deployer) *SSOManager {
    return &SSOManager{deployer: deployer}
}

func (s *SSOManager) IntegrateAll() error {
    fmt.Println("üîê Integrating services with Keycloak SSO...")
    
    // 1. Create Keycloak realm
    if err := s.createRealm("ceres"); err != nil {
        return err
    }
    
    // 2. Create OIDC clients
    clients := []string{
        "gitlab", "grafana", "mattermost", "wikijs",
        "nextcloud", "mailcow", "oauth2-proxy",
    }
    
    for _, client := range clients {
        fmt.Printf("  üìù Creating client: %s\n", client)
        if err := s.createClient(client); err != nil {
            return err
        }
    }
    
    // 3. Deploy OAuth2 Proxy
    if err := s.deployer.ApplyManifest("deployment/oauth2-proxy.yaml"); err != nil {
        return err
    }
    
    // 4. Update service configurations
    services := map[string]string{
        "gitlab":     "deployment/gitlab-keycloak.yaml",
        "grafana":    "deployment/grafana-keycloak.yaml",
        "mattermost": "deployment/mattermost-keycloak.yaml",
        "wikijs":     "deployment/wikijs-keycloak.yaml",
    }
    
    for name, manifest := range services {
        fmt.Printf("  üîß Configuring %s...\n", name)
        if err := s.deployer.ApplyManifest(manifest); err != nil {
            return err
        }
    }
    
    // 5. Update Ingress with OAuth2 Proxy annotations
    if err := s.updateIngressForSSO(); err != nil {
        return err
    }
    
    fmt.Println("‚úÖ SSO integration complete")
    return nil
}

func (s *SSOManager) createRealm(name string) error {
    // Use Keycloak Admin API
    return nil
}

func (s *SSOManager) createClient(name string) error {
    // Use Keycloak Admin API
    return nil
}

func (s *SSOManager) updateIngressForSSO() error {
    // Add OAuth2 Proxy annotations to Ingress
    return s.deployer.ApplyManifest("deployment/ingress-routes-sso.yaml")
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –í—Å–µ 10 —Å–µ—Ä–≤–∏—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç Keycloak –¥–ª—è –≤—Ö–æ–¥–∞
- [ ] Single Sign-On —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤—Ö–æ–¥ –≤ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å = –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º)
- [ ] Logout –∏–∑ Keycloak –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [ ] –†–æ–ª–∏ Keycloak —É–ø—Ä–∞–≤–ª—è—é—Ç –¥–æ—Å—Ç—É–ø–æ–º (admin, user, viewer)

---

### 4.7. –§–ê–ó–ê 7: HEALTH CHECK & MONITORING (–î–µ–Ω—å 8-9)

#### –ó–∞–¥–∞—á–∞ 6.1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 2 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**: –°–º. QUICK_ANALYSIS.md, —Ä–∞–∑–¥–µ–ª Priority 5

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] –ö–æ–º–∞–Ω–¥–∞ `ceres health` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã
- [ ] –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Markdown

---

#### –ó–∞–¥–∞—á–∞ 6.2: Grafana Dashboards
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –°—Ä–µ–¥–Ω–∏–π  
**–¢—Ä—É–¥–æ–µ–º–∫–æ—Å—Ç—å**: 2 —á–∞—Å–∞  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å**: DevOps Engineer

**–û–ø–∏—Å–∞–Ω–∏–µ**: –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

**–î–∞—à–±–æ—Ä–¥—ã**:
1. **CERES Platform Overview**
   - Running pods / Total pods
   - CPU/Memory usage
   - Network traffic
   - Storage usage

2. **Service Health**
   - PostgreSQL connections
   - Redis operations/sec
   - GitLab uptime
   - Keycloak sessions

3. **Logs Dashboard**
   - Error rate by service
   - Top 10 errors
   - Log volume

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏**:
- [ ] 3 –¥–∞—à–±–æ—Ä–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Grafana
- [ ] –í—Å–µ –ø–∞–Ω–µ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ
- [ ] –ê–ª–µ—Ä—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

---

## 5. –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò –ü–†–û–ï–ö–¢–ê

### 5.1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ö—Ä–∏—Ç–µ—Ä–∏–∏

#### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (Must Have)
- [ ] **–í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç**: PostgreSQL, Redis, Keycloak, GitLab, Ingress NGINX
- [ ] **Zero CrashLoopBackOff**: –ù–µ—Ç –ø–∞–¥–∞—é—â–∏—Ö –ø–æ–¥–æ–≤
- [ ] **Backup –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω**: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π backup —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ 02:00
- [ ] **TLS —Ä–∞–±–æ—Ç–∞–µ—Ç**: –í—Å–µ –≤–µ–±-—Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ HTTPS
- [ ] **CLI –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω**: –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

#### –í–∞–∂–Ω—ã–µ (Should Have)
- [ ] **VPN setup –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π**: `ceres vpn setup` —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥
- [ ] **–õ–æ–≥–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è**: Promtail ‚Üí Loki —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–ª–Ω—ã–π**: Grafana –¥–∞—à–±–æ—Ä–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] **Health check –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π**: `ceres health` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

#### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (Nice to Have)
- [ ] **OAuth2 Proxy**: –ï–¥–∏–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- [ ] **GitOps**: Flux CD —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å Git
- [ ] **–ê–ª–µ—Ä—Ç—ã**: Email/Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### 5.2. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ö—Ä–∏—Ç–µ—Ä–∏–∏

- [ ] **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –í—Ä–µ–º—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è < 15 –º–∏–Ω—É—Ç
- [ ] **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: Uptime > 99.9%
- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] **–¢–µ—Å—Ç—ã**: E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

### 5.3. –ú–µ—Ç—Ä–∏–∫–∏ –£—Å–ø–µ—Ö–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|---------|---------|---------|-------------|
| Running Pods | 27/38 (71%) | 25/25 (100%) | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| CrashLoopBackOff | 9 | 0 | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| RAM Usage | ~12GB | ~8GB | –í–∞–∂–Ω–æ |
| –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è | 60% | 95% | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| MTTR | N/A | < 5 –º–∏–Ω | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Backup Frequency | –ù–µ—Ç | –ï–∂–µ–¥–Ω–µ–≤–Ω–æ | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| TLS Coverage | 0% | 100% | –í–∞–∂–Ω–æ |

---

## 6. –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

### 6.1. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –†–∏—Å–∫–∏

#### –†–∏—Å–∫ 1: GitLab –¢—Ä–µ–±—É–µ—Ç –ú–Ω–æ–≥–æ –†–µ—Å—É—Ä—Å–æ–≤
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –í—ã—Å–æ–∫–∞—è  
**–í–ª–∏—è–Ω–∏–µ**: –ö—Ä–∏—Ç–∏—á–Ω–æ–µ  
**–û–ø–∏—Å–∞–Ω–∏–µ**: GitLab –º–æ–∂–µ—Ç –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö —Å < 8GB RAM

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å resource limits
- –û—Ç–∫–ª—é—á–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (Prometheus, Sentry)
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gitea (lightweight)

#### –†–∏—Å–∫ 2: –ü–æ—Ç–µ—Ä—è –î–∞–Ω–Ω—ã—Ö –ü—Ä–∏ –£–¥–∞–ª–µ–Ω–∏–∏ –î—É–±–ª–∏–∫–∞—Ç–æ–≤
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ**: –°—Ä–µ–¥–Ω–µ–µ  
**–û–ø–∏—Å–∞–Ω–∏–µ**: Elasticsearch –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–∞–∂–Ω—ã–µ –ª–æ–≥–∏

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ Elasticsearch –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- Backup namespace –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º

#### –†–∏—Å–∫ 3: TLS –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ù–µ –í—ã–ø—É—Å–∫–∞—é—Ç—Å—è
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ**: –°—Ä–µ–¥–Ω–µ–µ  
**–û–ø–∏—Å–∞–Ω–∏–µ**: Let's Encrypt –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ IP

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å self-signed —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞)
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ CA –≤ trusted

#### –†–∏—Å–∫ 4: Velero Backup –ó–∞–ø–æ–ª–Ω—è–µ—Ç –î–∏—Å–∫
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ**: –í—ã—Å–æ–∫–æ–µ  
**–û–ø–∏—Å–∞–Ω–∏–µ**: Backups –º–æ–≥—É—Ç –∑–∞–Ω—è—Ç—å –≤–µ—Å—å –¥–∏—Å–∫ MinIO

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- TTL 30 –¥–Ω–µ–π –¥–ª—è backups
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ MinIO bucket
- –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ > 80%

### 6.2. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –†–∏—Å–∫–∏

#### –†–∏—Å–∫ 5: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ó–Ω–∞–Ω–∏–π Kubernetes
**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å**: –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ**: –°—Ä–µ–¥–Ω–µ–µ  
**–û–ø–∏—Å–∞–Ω–∏–µ**: –ö–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –Ω–µ –∑–Ω–∞—Ç—å –∫–∞–∫ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å K8s

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è**:
- –û–±—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–¥–∞—á –≤ CLI
- Runbook –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

---

## 7. –ì–†–ê–§–ò–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### 7.1. Gantt Chart

```
–î–µ–Ω—å 1-2: –°–¢–ê–ë–ò–õ–ò–ó–ê–¶–ò–Ø
‚îú‚îÄ [1h]  –ó–∞–¥–∞—á–∞ 1.1: –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
‚îú‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 1.2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Ingress NGINX
‚îú‚îÄ [3h]  –ó–∞–¥–∞—á–∞ 1.3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Keycloak
‚îú‚îÄ [4h]  –ó–∞–¥–∞—á–∞ 1.4: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GitLab
‚îî‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 1.5: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Nextcloud

–î–µ–Ω—å 3: TLS AUTOMATION
‚îú‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 2.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Cert-Manager
‚îî‚îÄ [1h]  –ó–∞–¥–∞—á–∞ 2.2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Ingress Routes

–î–µ–Ω—å 4: BACKUP & RECOVERY
‚îú‚îÄ [3h]  –ó–∞–¥–∞—á–∞ 3.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Velero
‚îî‚îÄ [1h]  –ó–∞–¥–∞—á–∞ 3.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ backup/restore

–î–µ–Ω—å 5: LOGGING PIPELINE
‚îú‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 4.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Promtail
‚îî‚îÄ [1h]  –ó–∞–¥–∞—á–∞ 4.2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ Grafana

–î–µ–Ω—å 6: VPN AUTOMATION
‚îú‚îÄ [3h]  –ó–∞–¥–∞—á–∞ 5.1: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è WireGuard
‚îî‚îÄ [1h]  –ó–∞–¥–∞—á–∞ 5.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VPN

–î–µ–Ω—å 7: MAILCOW & SSO INTEGRATION
‚îú‚îÄ [4h]  –ó–∞–¥–∞—á–∞ 6.1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Mailcow
‚îî‚îÄ [6h]  –ó–∞–¥–∞—á–∞ 6.2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Keycloak —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏

–î–µ–Ω—å 8-9: HEALTH CHECK & MONITORING
‚îú‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 7.1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
‚îú‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 7.2: Grafana Dashboards
‚îú‚îÄ [2h]  –ó–∞–¥–∞—á–∞ 7.3: SMTP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤
‚îî‚îÄ [2h]  –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### 7.2. Milestones

| Milestone | –î–∞—Ç–∞ | –ö—Ä–∏—Ç–µ—Ä–∏–∏ |
|-----------|------|----------|
| **M1: –°—Ç–∞–±–∏–ª—å–Ω–∞—è –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞** | –î–µ–Ω—å 2 | 0 CrashLoopBackOff, –≤—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã Running |
| **M2: HTTPS Enabled** | –î–µ–Ω—å 3 | Cert-Manager —Ä–∞–±–æ—Ç–∞–µ—Ç, TLS –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |
| **M3: Backup –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω** | –î–µ–Ω—å 4 | Velero —Å–æ–∑–¥–∞–µ—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ backups |
| **M4: –ü–æ–ª–Ω–æ–µ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | –î–µ–Ω—å 5 | Promtail —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏, –≤–∏–¥–Ω—ã –≤ Grafana |
| **M5: One-Click VPN** | –î–µ–Ω—å 6 | `ceres vpn setup` —Ä–∞–±–æ—Ç–∞–µ—Ç |
| **M6: Production Ready** | –î–µ–Ω—å 7 | –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã |

---

## 8. –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### 8.1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–°–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω—ã:

1. **README.md**
   - –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Backup & Recovery"
   - –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ (—É–±—Ä–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã)
   - –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é "Security (TLS)"

2. **VERSIONING.md**
   - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –æ v3.1.0
   - –û–ø–∏—Å–∞—Ç—å breaking changes (—É–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤)

3. **QUICKSTART.md**
   - –û–±–Ω–æ–≤–∏—Ç—å —à–∞–≥–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
   - –î–æ–±–∞–≤–∏—Ç—å VPN setup

4. **DEPLOYMENT_PLAN.md**
   - –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–∑—ã
   - –û–±–Ω–æ–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

5. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
   - **BACKUP_GUIDE.md** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ backup/restore
   - **TLS_SETUP.md** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
   - **VPN_GUIDE.md** - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ VPN
   - **TROUBLESHOOTING.md** - –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º

### 8.2. Runbook

–°–æ–∑–¥–∞—Ç—å runbook –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

```markdown
# CERES Platform Runbook

## Scenario 1: Pod –≤ CrashLoopBackOff
1. `ceres diagnose` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
2. `kubectl logs -n <namespace> <pod> --tail=100`
3. `ceres fix <service>` - –∞–≤—Ç–æ–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
4. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Üí –°–º. TROUBLESHOOTING.md

## Scenario 2: –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å–∞–º
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Ingress: `kubectl get ingress -A`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å VPN: `ceres vpn status`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å NodePort: `kubectl get svc -A | grep NodePort`

## Scenario 3: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup
1. `ceres backup list` - —Å–ø–∏—Å–æ–∫ backups
2. `ceres backup restore <name>` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
3. –ü—Ä–æ–≤–µ—Ä–∫–∞: `ceres status`
```

---

## 9. –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### 9.1. Unit Tests

```go
// pkg/deployment/deployer_test.go
func TestRemoveDuplicates(t *testing.T) {
    // Mock kubectl calls
    // Test successful deletion
    // Test error handling
}

func TestFixKeycloak(t *testing.T) {
    // Test database creation
    // Test pod restart
    // Test readiness check
}
```

### 9.2. Integration Tests

```bash
#!/bin/bash
# tests/integration_test.sh

echo "=== CERES v3.1 Integration Tests ==="

# Test 1: Deployment
./bin/ceres deploy --dry-run
if [ $? -ne 0 ]; then
    echo "‚ùå Deploy command failed"
    exit 1
fi

# Test 2: Status
./bin/ceres status | grep "Running"
if [ $? -ne 0 ]; then
    echo "‚ùå No running pods found"
    exit 1
fi

# Test 3: Backup
./bin/ceres backup create test-backup
./bin/ceres backup list | grep "test-backup"
if [ $? -ne 0 ]; then
    echo "‚ùå Backup not created"
    exit 1
fi

# Test 4: Health Check
./bin/ceres health
if [ $? -ne 0 ]; then
    echo "‚ùå Health check failed"
    exit 1
fi

echo "‚úÖ All integration tests passed"
```

### 9.3. E2E Tests

```yaml
# tests/e2e/test-suite.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: e2e-tests
data:
  test.sh: |
    #!/bin/bash
    # E2E Test: Full Platform Deployment
    
    # 1. Deploy platform
    ceres deploy
    
    # 2. Wait for all pods Running
    kubectl wait --for=condition=Ready pods --all --all-namespaces --timeout=600s
    
    # 3. Test service endpoints
    curl -k https://grafana.ceres.local
    curl -k https://gitlab.ceres.local
    
    # 4. Create backup
    ceres backup create e2e-test
    
    # 5. Simulate failure
    kubectl delete pod -n ceres -l app=keycloak
    
    # 6. Verify auto-recovery
    sleep 30
    ceres health
    
    # 7. Restore from backup
    ceres backup restore e2e-test
    
    echo "‚úÖ E2E tests completed"
```

---

## 10. –ü–û–î–î–ï–†–ñ–ö–ê –ò –≠–ö–°–ü–õ–£–ê–¢–ê–¶–ò–Ø

### 10.1. SLA

| Service | Uptime | MTTR | RPO | RTO |
|---------|--------|------|-----|-----|
| PostgreSQL | 99.9% | 5 min | 24h | 30 min |
| Redis | 99.9% | 5 min | 24h | 15 min |
| Keycloak | 99.5% | 10 min | 24h | 30 min |
| GitLab | 99.5% | 15 min | 24h | 60 min |
| Monitoring | 99.0% | 30 min | N/A | N/A |

### 10.2. On-Call Runbook

**–ê–ª–µ—Ä—Ç: Pod CrashLoopBackOff**
```
1. Severity: P1 (Critical)
2. Action:
   - ssh to server
   - ceres diagnose
   - ceres fix <service>
3. Escalation: If not resolved in 30 min ‚Üí Senior DevOps
```

**–ê–ª–µ—Ä—Ç: Disk Space > 90%**
```
1. Severity: P2 (High)
2. Action:
   - Check backup storage: kubectl exec -n minio minio-xxx -- df -h
   - Delete old backups: ceres backup delete <old-backup>
   - Increase PVC size if needed
3. Escalation: If disk full ‚Üí P1
```

---

## 11. –°–¢–û–ò–ú–û–°–¢–¨ –ò –†–ï–°–£–†–°–´

### 11.1. –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã

| –§–∞–∑–∞ | –ó–∞–¥–∞—á | –ß–∞—Å–æ–≤ | –ß–µ–ª–æ–≤–µ–∫–æ-–¥–Ω–µ–π |
|------|-------|-------|---------------|
| –§–∞–∑–∞ 1: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è | 5 | 12 | 1.5 |
| –§–∞–∑–∞ 2: TLS | 2 | 3 | 0.4 |
| –§–∞–∑–∞ 3: Backup | 2 | 4 | 0.5 |
| –§–∞–∑–∞ 4: Logging | 2 | 3 | 0.4 |
| –§–∞–∑–∞ 5: VPN | 2 | 4 | 0.5 |
| –§–∞–∑–∞ 6: Mailcow & SSO | 2 | 10 | 1.3 |
| –§–∞–∑–∞ 7: Monitoring | 3 | 6 | 0.8 |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | - | 4 | 0.5 |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | - | 4 | 0.5 |
| **–ò–¢–û–ì–û** | **18** | **50** | **6.4** |

### 11.2. –ö–æ–º–∞–Ω–¥–∞

- **DevOps Engineer (Senior)**: 1 —á–µ–ª–æ–≤–µ–∫, full-time, 9 –¥–Ω–µ–π
- **QA Engineer**: 0.5 —á–µ–ª–æ–≤–µ–∫–∞ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ), 2 –¥–Ω—è

### 11.3. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–¢–µ–∫—É—â–∞—è** (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ):
- Proxmox: 1 —Å–µ—Ä–≤–µ—Ä (8 CPU, 16GB RAM, 200GB SSD)
- K3s: 1 node

**–ï—Å–ª–∏ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- +2 worker nodes (8 CPU, 16GB RAM each)
- –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$100-200/–º–µ—Å—è—Ü (–æ–±–ª–∞–∫–æ) –∏–ª–∏ $0 (on-premise)

---

## 12. –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### 12.1. –ì–ª–æ—Å—Å–∞—Ä–∏–π

- **CrashLoopBackOff**: –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–∞, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–∞–¥–∞–µ—Ç –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- **ClusterIP**: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP-–∞–¥—Ä–µ—Å —Å–µ—Ä–≤–∏—Å–∞ –≤ Kubernetes
- **NodePort**: –ü–æ—Ä—Ç –Ω–∞ —É–∑–ª–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–∏—Å—É –∏–∑–≤–Ω–µ
- **PVC**: Persistent Volume Claim - –∑–∞–ø—Ä–æ—Å –Ω–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **StatefulSet**: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è stateful –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–ë–î)
- **DaemonSet**: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ

### 12.2. –°—Å—ã–ª–∫–∏

- [Cert-Manager Documentation](https://cert-manager.io/docs/)
- [Velero Documentation](https://velero.io/docs/)
- [Promtail Configuration](https://grafana.com/docs/loki/latest/clients/promtail/)
- [WireGuard Quick Start](https://www.wireguard.com/quickstart/)
- [K3s Documentation](https://docs.k3s.io/)

---

## –°–û–ì–õ–ê–°–û–í–ê–ù–ò–ï

| –†–æ–ª—å | –§–ò–û | –ü–æ–¥–ø–∏—Å—å | –î–∞—Ç–∞ |
|------|-----|---------|------|
| –ó–∞–∫–∞–∑—á–∏–∫ | | | |
| –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –õ–∏–¥–µ—Ä | | | |
| DevOps Lead | | | |
| QA Lead | | | |

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 21 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å**: –ù–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–∏
