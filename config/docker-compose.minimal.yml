services:
  traefik:
    build:
      context: ./traefik
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--providers.file.filename=/etc/traefik/dynamic.yml"
      - "--entrypoints.web.address=:80"
      - "--entrypoints.websecure.address=:443"
      - "--certificatesresolvers.myresolver.acme.email=admin@Ceres.local"
      - "--certificatesresolvers.myresolver.acme.storage=/letsencrypt/acme.json"
      - "--certificatesresolvers.myresolver.acme.tlschallenge=true"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
      - "traefik_letsencrypt:/letsencrypt"
    networks:
      - internal

  postgres:
    image: postgres:15-alpine
    environment:
      POSTGRES_PASSWORD: "R@nd0mP@ssw0rd!2025"
      POSTGRES_DB: "company"
    volumes:
      - pg_data:/var/lib/postgresql/data
    networks:
      - internal

  redis:
    image: redis:7-alpine
    networks:
      - internal

  keycloak:
    image: quay.io/keycloak/keycloak:24.0.1
    command: ["start-dev"]
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: K3yClo@k!2025
      KC_DB: postgres
      KC_DB_URL_HOST: postgres
      KC_DB_USERNAME: postgres
      KC_DB_PASSWORD: "R@nd0mP@ssw0rd!2025"
      KC_DB_URL_DATABASE: company
    depends_on:
      - postgres
    networks:
      - internal

  gitea:
    image: gitea/gitea:1.22
    environment:
      DB_TYPE: postgres
      DB_HOST: postgres:5432
      DB_NAME: company
      DB_USER: postgres
      DB_PASSWD: "R@nd0mP@ssw0rd!2025"
    volumes:
      - gitea_data:/data
    depends_on:
      - postgres
    networks:
      - internal

  grafana:
    image: grafana/grafana:10.2.0
    depends_on:
      - prometheus
    networks:
      - internal

  prometheus:
    image: prom/prometheus:latest
    networks:
      - internal

  minio:
    image: minio/minio:latest
    command: ["server", "/data", "--console-address", ":9001"]
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadminsecret
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_data:/data
    networks:
      - internal

  netdata:
    image: netdata/netdata:latest
    cap_add:
      - SYS_PTRACE
    ports:
      - "19999:19999"
    networks:
      - internal

networks:
  internal:
    name: config_internal
    driver: bridge

volumes:
  pg_data:
    name: config_pg_data
  traefik_letsencrypt:
    name: config_traefik_letsencrypt
  minio_data:
    name: config_minio_data
  gitea_data:
    name: config_gitea_data
