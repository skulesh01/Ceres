{
  # Optional: set email for ACME account registration
  # email {$ACME_EMAIL}

  # Global options: keep logs simple by default.
  # debug
}

# NOTE
# - For public domains: leave TLS to Caddy (automatic HTTPS via Let's Encrypt).
# - For internal/dev domains (like ceres): uncomment `tls internal` blocks below.
#
# Required DNS:
#   auth.{$DOMAIN} -> your host public IP
#   nextcloud.{$DOMAIN} -> your host public IP
#   gitea.{$DOMAIN} -> your host public IP
#   mattermost.{$DOMAIN} -> your host public IP
#   wiki.{$DOMAIN} -> your host public IP
#   taiga.{$DOMAIN} -> your host public IP
#   grafana.{$DOMAIN} -> your host public IP
#   (optionally) portainer.{$DOMAIN}, uptime.{$DOMAIN}

(auth) {
  tls internal
  reverse_proxy keycloak:8080
}

(nextcloud) {
  tls internal
  reverse_proxy nextcloud:80
}

(gitea) {
  tls internal
  reverse_proxy gitea:3000
}

(mattermost) {
  tls internal
  reverse_proxy mattermost:8065
}

(wiki) {
  tls internal
  reverse_proxy wikijs:3000
}

(taiga) {
  tls internal

  # Single hostname for Taiga:
  # - /api/* -> Taiga API
  # - /events -> Taiga Events (WebSocket)
  # - everything else -> Taiga Front
  handle /api/* {
    reverse_proxy taiga-back:8000
  }

  handle /events* {
    reverse_proxy taiga-events:8888
  }

  reverse_proxy taiga-front:80
}

(grafana) {
  tls internal
  reverse_proxy grafana:3000
}

(prometheus) {
  tls internal
  # WARNING: do not expose Prometheus publicly without auth/VPN.
  reverse_proxy prometheus:9090
}

(portainer) {
  tls internal
  # WARNING: do not expose Portainer publicly without auth/VPN.
  reverse_proxy portainer:9000
}

(uptime) {
  tls internal
  reverse_proxy uptime-kuma:3001
}

(edms) {
  tls internal
  reverse_proxy mayan:8000
}

# Sites

auth.{$DOMAIN} {
  import auth
}

nextcloud.{$DOMAIN} {
  import nextcloud
}

gitea.{$DOMAIN} {
  import gitea
}

mattermost.{$DOMAIN} {
  import mattermost
}

wiki.{$DOMAIN} {
  import wiki
}

taiga.{$DOMAIN} {
  import taiga
}

grafana.{$DOMAIN} {
  import grafana
}

edms.{$DOMAIN} {
  import edms
}

# Optional / admin sites
# prometheus.{$DOMAIN} { import prometheus }
# portainer.{$DOMAIN} { import portainer }
# uptime.{$DOMAIN} { import uptime }
